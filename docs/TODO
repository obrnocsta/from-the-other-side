# Routes & Paths

## Intro (new)

**Our three main tasks:**

- Server assets
- Provide data via an API
- Add user input to our data

**Extra:**

- A section on events

**We will be studying:**

- The 'fs' module
  - reading/writing files
- The 'path' module
  - create file/directory paths

## Setting up the project

**Challenge:**

```bash
# 1. 
#   Initialise a nodejs project:
#   Name: “from-the-other-side”.
#   Description: “A platform for sharing ghostly encounters”.
# 2.
#   Enable modular js (in package.json).
```

**Hint for help:**

```bash
# In terminal:
npm init

# In package.json: 
"type": "module"
```

**Challenge:**

```bash
# 1.
#   Set up a server that serves the string 
#   '<html><h1>The server is working</h1></html>'.
#   What should the content type be? 
#   What status code should you send?

# 2. 
#   Listen on port 8000 and log a connection message to the console.

# 3. 
#   Open the browser to see your first served HTML.
```

## Rounting and serving data

- Identify what `resources` the client wants.
- Identify the `path` to that resources:
  - The current module's directory.
  - The path to the resource from that directory.
- Read the resources we want to serve using `fs module`.
- Send those resources to the client.

**Important:** We need to be OS agnostic!

**import-meta**: 

- Is an object specific to the modular JS enviroment, which provides metadata about the current module.

**Hint:**

```js
const __dirname = import.meta.dirname
```

## Aside: Path Module

**Relative paths created with Path Module:**

- Start from the `Current Working Directory` - CWD.
- Are therefore affected by changes to the CWD.
- That means they are not as safe, but sometimes more flexible.

**Hint:**

```js
// server.js
import path from 'node:path'
const __dirname = import.meta.dirname
// inside server callback function
const pathFile = path.join(__dirname, 'public', 'index.html')
```

## Get Path to Resource

**Challenge:**

```bash
# 1. 
#   Get the name of the directory holding this server.js file and store it to a const ‘__dirname’.
# 2.
#   Create and export a function called 'serveStatic'. 
#   It should take in the base directory as a parameter.
#   Build a path to index.html in the 'public' folder and save it to a const 'filePath'. 
#   (Which node module will you need to import to do this? Which method joins the path together?)
#   Log 'filePath' to the console.
# 3.
#   Import and call serveStatic and pass it the directory of this current module.
```

## Aside: FS Module

**FS Module uses:**

- Read files `readFile()`
- Create files `writeFile()`
- Update files `appendFIle()`
- Delete files `unlink()`
- Rename files `rename()`

```js
// server.js
import fs from 'node:fs/promises'
// inside server callback function
const content = await fs.readFile(pathFile)
```

## Server index.html

**Challenge:**

```js
// 1.
//   Store index.html as a buffer in a const ‘content’. 
//   As this is an async process, do this inside a try/catch block.
//   For now, just log the error in the catch block.
//   You will need to change something to do with the function declaration. What is it?

// 2.
//   Create and export a function called sendResponse().  
//   What 4 things should this function take in as parameters?

// 3.
//   Import sendResponse() and use it to serve index.html. 
//   Pass in all of the information sendResponse() is expecting.
//   serveStatic() will need another param. What is it?

//   Make any changes necessary in server.js and delete any unneeded code.
```
